<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dosis de Lotrial – Santiago</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{
      --bg:#0e0f12; --card:#171922; --accent:#00e676; --accent2:#ff6b6b; --muted:#aab2c0;
    }
    body{background:var(--bg); color:#e9eef5;}
    .card{background:var(--card); border:1px solid #23273a;}
    .badge-time{background:#22283a;border:1px solid #2e3450;}
    .glow{box-shadow:0 0 0.75rem rgba(0,230,118,.25);}
    .result-ok{color:var(--accent);}
    .result-warn{color:#ffd166;}
    .result-alert{color:var(--accent2);}
    code{color:#9ad0ff;}
    .small-muted{color:var(--muted); font-size:.9rem;}
    .pill{display:inline-block;padding:.2rem .55rem;border-radius:.5rem;background:#101521;border:1px solid #243047;}
  </style>
</head>
<body>
<div class="container py-4">
  <header class="mb-4 d-flex align-items-center justify-content-between">
    <h1 class="h3 mb-0">Dosis de <span class="text-success">Lotrial</span> – Santiago</h1>
    <span class="badge badge-time rounded-pill px-3 py-2" id="clock">--:--</span>
  </header>

  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card p-3 p-md-4 glow">
        <h2 class="h5 mb-3">Ingresá el valor medido</h2>

        <div class="row g-3 align-items-end">
          <div class="col-sm-6">
            <label class="form-label">Presión / valor (usar coma o punto)</label>
            <input type="text" class="form-control form-control-lg" id="reading" placeholder="Ej: 10,6">
            <div class="small-muted mt-1">Ejemplos válidos: <span class="pill">9,8</span> <span class="pill">10.5</span> <span class="pill">12,2</span></div>
          </div>

          <div class="col-sm-6">
            <label class="form-label">Momento del día</label>
            <select id="moment" class="form-select">
              <option value="auto">Automático (según hora)</option>
              <option value="morning">Mañana</option>
              <option value="afternoon">Tarde</option>
            </select>
            <div class="small-muted mt-1">
              Mañana aplica <b>Pauta A</b>. Tarde aplica <b>Pauta B</b>.
            </div>
          </div>

          <div class="col-12">
            <button id="btnCalc" class="btn btn-success btn-lg w-100">Calcular dosis</button>
          </div>
        </div>

        <hr class="my-4">

        <div id="output" class="fs-5">
          Ingresá un valor y presioná “Calcular dosis”.
        </div>

      </div>
    </div>

    <div class="col-lg-6">
      <div class="card p-3 p-md-4">
        <h2 class="h6 mb-3">Reglas usadas</h2>
        <div class="mb-3">
          <div class="fw-semibold text-uppercase small-muted">Pauta A – <b>Mañana</b></div>
          <ul class="mb-0">
            <li><code>9,5 – 10,5</code> → <b>nada</b></li>
            <li><code>10,6 – 12,1</code> → <b>½ Lotrial 5</b></li>
            <li><code>≥ 12,2</code> → <b>1 Lotrial 5</b></li>
          </ul>
        </div>
        <div class="mb-3">
          <div class="fw-semibold text-uppercase small-muted">Pauta B – <b>Tarde</b></div>
          <ul class="mb-0">
            <li><code>9,5 – 11,6</code> → <b>nada</b></li>
            <li><code>11,7 – 12,7</code> → <b>¼ Lotrial 5</b></li>
            <li><code>≥ 12,8</code> → <b>consultar</b> (no visible en el recorte)</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Reloj
  const clockEl = document.getElementById('clock');
  const tick = () => clockEl.textContent =
    new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
  tick(); setInterval(tick, 1000);

  // Reglas definitivas: A = mañana, B = tarde
  const RULES = {
    morningA: [
      { range: [9.5, 10.5], dose: 'nada' },
      { range: [10.6, 12.1], dose: '½ Lotrial 5' },
      { range: [12.2, Infinity], dose: '1 Lotrial 5' },
    ],
    afternoonB: [
      { range: [9.5, 11.6], dose: 'nada' },
      { range: [11.7, 12.7], dose: '¼ Lotrial 5' },
      { range: [12.8, Infinity], dose: 'consultar' }, // no visible en el recorte
    ]
  };

  function getMoment(selected) {
    if (selected !== 'auto') return selected;
    const h = new Date().getHours();
    // Mañana 05:00–12:00; Tarde 12:00–22:00
    if (h >= 5 && h < 12) return 'morning';
    if (h >= 12 && h <= 22) return 'afternoon';
    return 'afternoon';
  }

  function classify(value, moment) {
    const set = (moment === 'morning') ? RULES.morningA : RULES.afternoonB;
    for (const r of set) {
      const [lo, hi] = r.range;
      if (value >= lo && value <= hi) return r.dose;
    }
    return 'consultar';
  }

  function colorClassFor(dose) {
    const s = dose.toLowerCase();
    if (s.includes('nada')) return 'result-ok';
    if (s.includes('¼') || s.includes('1/4') || s.includes('½') || s.includes('1/2')) return 'result-warn';
    if (s.includes('1 lotrial') || s.includes('consultar')) return 'result-alert';
    return '';
  }

  document.getElementById('btnCalc').addEventListener('click', () => {
    const raw = document.getElementById('reading').value.trim().replace(',', '.');
    const v = Number(raw);
    const momentSel = document.getElementById('moment').value;
    const out = document.getElementById('output');

    if (!raw || Number.isNaN(v)) {
      out.innerHTML = '<span class="text-warning">Ingresá un número válido (ej: 10,6).</span>';
      return;
    }

    const mom = getMoment(momentSel);
    const dosis = classify(v, mom);
    const cls = colorClassFor(dosis);
    const momLabel = (mom === 'morning') ? 'Mañana (Pauta A)' : 'Tarde (Pauta B)';

    out.innerHTML = `
      <div class="${cls}">
        <div class="mb-1 small-muted">Momento: <b>${momLabel}</b> • Valor: <b>${v.toFixed(1)}</b></div>
        <div class="fs-4">Dosis: <b>${dosis}</b></div>
      </div>
      <div class="small-muted mt-3">Basado en el cartel: Pauta A = mañana, Pauta B = tarde.</div>
    `;
  });
</script>
</body>
</html>
